version: '3.8'

services:
  sku-recognition:
    build:
      context: .
      dockerfile: Dockerfile
    image: sku-recognition:latest
    container_name: sku-recognition-system

    # GPU support
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]

    # Environment variables
    environment:
      - MYSQL_HOST=${MYSQL_HOST:-localhost}
      - MYSQL_PORT=${MYSQL_PORT:-3306}
      - MYSQL_DATABASE=${MYSQL_DATABASE}
      - MYSQL_USER=${MYSQL_USER}
      - MYSQL_PASSWORD=${MYSQL_PASSWORD}
      - DEVICE=cuda
      - CLIP_MODEL=ViT-B/32

    # Volumes
    volumes:
      - ./data:/app/data
      - ./output:/app/output
      - ./logs:/app/logs
      - ./models:/app/models
      - ./config:/app/config
      # Mount your images for inference
      - ./test_images:/app/test_images:ro

    # Network
    networks:
      - sku-network

    # Keep container running
    tty: true
    stdin_open: true

    # Command (override as needed)
    # command: python3 scripts/run_inference.py /app/test_images/test.jpg

networks:
  sku-network:
    driver: bridge
